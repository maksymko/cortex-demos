<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cortex-DemOS: Build process</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Cortex-DemOS<span id="projectnumber">&#160;0.1</span>
   </div>
   <div id="projectbrief">Cortex-M Microcontroller Operating System with focus on testability</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Build process </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >The project uses <a href="https://scons.org/documentation.html">SCons</a> as a software construction tool. The word <em>Environment</em> in this document refers to the <a href="https://scons.org/doc/production/HTML/scons-user/ch07s02.html">SCons Construction Environment</a>. Refer to the SCons documentation for further details.</p>
<p >To build everything, simply type:</p>
<div class="fragment"><div class="line">scons</div>
</div><!-- fragment --><p >After build finishes, you can run all tests by typing:</p>
<div class="fragment"><div class="line">./run_all_tests.sh</div>
</div><!-- fragment --><h1>Overview</h1>
<p >Somewhat simplified build diagram:</p>
<p ><img src="build_graph.png" alt="Build Process" class="inline"/></p>
<ul>
<li>Sources are in brown.</li>
<li>Environments are diamond shaped and in light blue.</li>
<li>Produced binaries are green. Target SoC specific binaries are in darker green, host binaries are in lighter green.</li>
</ul>
<p >The two main deliverables of the build are:</p>
<ul>
<li>Applications</li>
<li>Test Programs (i.e. programs that execute tests)</li>
</ul>
<p >Note, that, as an intermediate step, the library is also built for every supported platform. Eventually, the goal is to have <em>library</em> as a main deliverable in place of applications, but right now there is no simple way to build application outside of this repository. See issue #8. Until that is resolved, the library is considered an "intermediate".</p>
<p >Next sections go into more details about how binaries are produced.</p>
<h1><a class="anchor" id="target-library"></a>
Target Library</h1>
<p >This is the Target SoC specific library. On the diagram above it is referred to as <code>demos_SoC</code>. As noted above, for now this is considered to be an intermediate step.</p>
<p >The library is built from these parts (the names that end in <code>/</code> refer to directories in source code):</p>
<ul>
<li><code>driver/</code> - defines common APIs for similar peripherals (SPI, I2C, etc.) and common functionality.</li>
<li><code>core/</code> - core concepts of the OS itself. These can sometimes wrap similar concepts in FreeRTOS.</li>
<li><code>chip-NAME/</code> - chip (SoC) specific code. In many cases these are implementations of the drivers, defined within <code>driver/</code> directory, but also define some properties of a chip, like number of supported IRQs.</li>
<li>MMIO - for target code this layer translates the MMIO calls to, well, raw volatile memory reads and writes.</li>
</ul>
<h1>Application</h1>
<p >Applications use <a class="el" href="md_build.html#target-library">Target Library</a> specific to their SoC. FreeRTOS is built for every application separately, because it needs a configuration (<code>FreeRTOSConfig.h</code>), which may be application specific.</p>
<p >Applications also have their own sources, which are the core of the application itself.</p>
<h1><a class="anchor" id="host-library"></a>
Host Library</h1>
<p >This one also sometimes referred to as "native" library. On the diagram above it is called <code>demos_native_SoC</code>.</p>
<p >The purpose of this library is to be used in tests. Two parts of this library &ndash; <code>core/</code> and <code>driver/</code> &ndash; are the same as the ones in <a class="el" href="md_build.html#target-library">Target Library</a>. The key difference is in the MMIO layer. MMIO operations are translated into function calls, but no definition for the functions themselves are provided, i.e. this becomes an external dependency. This will be exploited by <code>MMIO Mock</code> below, to make testing on the host possible.</p>
<p >There is also a "nativetest" layer defined specifically for this library (<code><a class="el" href="chip-nativetest_2chip_8h_source.html">chip-nativetest/chip.h</a></code>), which simply defines the SoC specific parameters to, well, some values so that the library will compile.</p>
<h1><a class="anchor" id="mock-library"></a>
Mock Library</h1>
<p >This library provides flexible implementations for the MMIO operations, which are left as external dependencies in Host Library. <em>Flexible</em> here means that the results of the operations can be defined by the caller (presumably test writer) on the fly, to reflect the needs of a specific test.</p>
<p >It also includes similar implementation for the FreeRTOS system calls, but this part is in the process of development, so not much can be said (yet).</p>
<h1>Tests</h1>
<p >The project uses <a href="https://github.com/catchorg/Catch2">Catch2</a> test framework. Host Library and Mock Library come together to provide fake hardware environment for drivers and other components under test. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
